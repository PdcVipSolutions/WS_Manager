<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<title>WorkSpaceManager</title></head>
<body>
<h2 style="font-family: Arial;"><small><small>Copyright (c) Prolog Developemnt Center SPb</small></small></h2><h2 style="font-family: Arial;">Экспериментальный проект WorkSpace Manager <br /></h2><h2 style="font-family: Arial;">Мотивация</h2>
<p style="font-family: Arial;">Идея разработки приложения WorkSpaceManager появилась при попытке
использовать приложение SolutionManager, входящее в состав
профессиональной версии Visual Prolog фирмы PDC.</p>
<p style="font-family: Arial;">Нужда в его использовании была вызвана тем, что в работе находились
одновременно несколько взаимозависимых проектов, которые надо было
совместно компилировать, запускать на исполнение. В особенности
напрягала ситуация использования системы Visual Prolog непосредственно
"из под пера" ее разработчиков, когда надо было компилировать все
множество проектов (их было около 50, включая различные небольшие примеры и тесты)</p>
<p style="font-family: Arial;">Не устроили несколько моментов:</p>
<ul style="font-family: Arial;">
<li>работа только с проектами системы Visual Prolog, в то время, как
требовалось использовать различные командные файлы или даже различные
редакторы;</li>
<li>невозможно было изменить порядок обработки проектов;</li>
<li>невозможность группировки проектов;</li>
<li>добавление проектов из одной директории не позволяло исключить из
рассмотрения некоторые из них и опять-таки изменить порядок их
обработки;</li>
<li>невозможность использования относительной адресации проектов в дисковом пространстве.</li>
</ul>
<p style="font-family: Arial;">В то же время нас интересовали темы:</p>
<ul style="font-family: Arial;">
<li>Строгое разделение логической части приложения и его пользовательского интерфейса;</li>
<li>Микросервисы;</li>
<li>Использование концепции плагинов в приложениях;</li>
<li>Возможность создания удаленных сервисов создания и компиляции
проектов Visual Prolog (идея однажды родилась в дискуссии Лео Йенсена и
Томаса Пулса, в которой я принимал участие).</li>
</ul>
<p style="font-family: Arial;">Поэтому в проекте WorkSpaceManager (WSM) сошлись воедино наши
потребности и наши архитектурные поиски, применительно к приложениям на
базе Visual Prolog.</p><p style="font-family: Arial;">Предполагается на этом проекте отрабатывать &nbsp;приемы и средства для построения полноценных микросервисов.</p><p style="font-family: Arial;">Проект
до первой рабочей версии был разработан В. Юхтенко (Prolog Development
Center SPb), позднее в работе принял участие Борис Белов. В решении
задач http взаимодействия оказал помощь Андрей Басукинский.</p>
<h2 style="font-family: Arial;">Функциональность</h2>
<h3 style="font-family: Arial;">Ресурс</h3>
<p style="font-family: Arial;">Основной единицей обработки в WSM является файл, расширение которого определяет его тип.&nbsp;</p>
 <p style="font-family: Arial;">Над каждым файлом могут выполняться четыре операции "Опер1", "Опер2", "Опер3" "Опер4".
Характер каждой из операций, применительно к файлу определенного типа, не является строго фиксированным
и определяется пользователем.
</p>
<p style="font-family: Arial;">В текущей реализации этим четырем операциям присвоены следующие имена</p>
<ul style="font-family: Arial;">
<li>"Опер1" - "Открыть";</li> 
<li>"Опер2" - "Построить";</li> 
<li>"Опер3" - "Построить полностью";</li>
<li>"Опер4" - "Выполнить".</li>
</ul><span style="font-family: Arial;">
что навеяно основными операциями над проектами в системе Visual Prolog.
</span><p style="font-family: Arial;">Так, для проектного файла системы Visual Prolog, имеющего расширение .vipprj, принято, что 
</p><ul style="font-family: Arial;">
<li>Операция "Открыть" вызывает открытие этого проекта в системе Visual Prolog.</li> 
<li>Операция "Построить" передает этот файл программе VipBuilder.exe, которая выполняет построение (Build) проекта,</li>
<li>Операция "Построить полностью" передает этот файл программе
VipBuilder.exe, но которая выполняет перестроение (Rebuild All) проекта,</li>
<li>Операция "Выполнить" вызывает исполнение построенного приложения.</li>
</ul>

<p style="font-family: Arial;">Для файла с любым другим расширением (другого типа) семантика
операций может быть любой другой, но в общем виде каждая операция
выглядит как командная строка в системе MSWindows</p>
<p style="font-family: Arial;"> <b>&lt;исполняющая программа&gt; &lt;префикс&gt; &lt;ресурс&gt; &lt;суффикс&gt;</b> </p>
<p style="font-family: Arial;">Так для операции "Построить" проектного файла <b>test.vipprj</b> системы Visual Prolog это выглядит так (с точностью до маршрутов):</p>
<p style="font-family: Arial; font-weight: bold;"> vipBuilder.exe /build test.vipprj</p>
<p style="font-family: Arial;">Что вызывает построение проекта <span style="font-weight: bold;">test.vipprj</span> и создание исполняемого приложения <span style="font-weight: bold;">test.exe</span>, в директории, установленной проектом.</p>
<h3 style="font-family: Arial;">WorkSpace</h3>
<p style="font-family: Arial;">WorkSpace (Рабочее Пространство) содержит множество файлов,
актуальных для пользователя. Пользователь добавляет и удаляет файлы
из рабочего пространства по мере необходимости.</p>
<p style="font-family: Arial;">WSМ позволяет структурировать множество файлов, группируя по критериям, определяемым пользователем. 
Структура представляется в виде дерева и не является отображением файловой системы.</p>
<p style="font-family: Arial;">Структура WorkSpace и результаты обработки файлов сохраняются в файле с расширением .wsm в формате XML.</p><p style="font-family: Arial;">Общий вид приложения приведен на следующем рисунке:</p><p style="font-family: Arial;"><img style="width: 1090px; height: 461px;" alt="" src="WSM_ru.PNG" /></p><h3 style="font-family: Arial;">Список&nbsp; файлов и дерево</h3><p style="font-family: Arial;">Основным рабочим пространоством пользователя является список файлов, расположенный в правой части формы.<br />Здесь указано&nbsp; имя файла , маршрут к нему, состояние обработки, число
ошибок и предупреждений, в ходе обработки и время последней обработки.</p><p style="font-family: Arial;">Предусмотрены четыре состояния результата обработки:</p><ul style="font-family: Arial;"><li>Done - выполнено успешно</li><li>Failed - выполнено неуспешно</li><li>NoPath - не найден маршрут к файлу или обрабатывающей программе</li><li>NoRule - правило обработки для данной операции не определено</li></ul><span style="font-family: Arial;">Над
каждым из файлов может быть выполнена одна из четырех описанных
операций (Опер1,Опер2,Опер3,Опер4), допустимых для файлов
соответствующего типа.</span><br style="font-family: Arial;" /><span style="font-family: Arial;">Над каждым файлом выделенного
(отмеченного) списка также может выполняться одна из этих операций.
Операции выполняются в порядке очередности сверху вниз.</span><br style="font-family: Arial;" /><p style="font-family: Arial;">Дерево
ресурсов в левой части формы&nbsp; является логическим представлением
пользователя о своем рабочем пространстве. Первоначально дерево
содержит всего один узел - корень, и все ресурсы правой части (если они
есть) принадлежат этому узлу. Пользователь может создать произвольную древовидную структуру<br /></p><span style="font-family: Arial;">Предусмотрены два типа узлов дерева - <span style="font-weight: bold;">группа</span> и <span style="font-weight: bold;">папка</span>.</span><br style="font-family: Arial;" /><span style="font-family: Arial;"><span style="font-weight: bold;">Группа</span>
может содержать подгруппы и ей может принадлежать произвольное число
файлов. В группе предусмотрены операции добавления, удаления файлов
и их перемещения.</span><br style="font-family: Arial;" /><span style="font-family: Arial;"><span style="font-weight: bold;">Папка</span> соответствует директории дискового
пространства и содержит только те&nbsp;файлы, типы которых определены в WSM, и &nbsp; которые содержатся в
директории и в ее поддиректориях.</span><br style="font-family: Arial;" /><span style="font-family: Arial;">Папка не может содержать
групп.&nbsp;Пользователь может перемещать файлы папки и (условно)
удалять&nbsp;их. Удаленные файлы остаются видимыми и меняют лишь
яркость отображения на экране. Пользователь может вернуть файл в
активное состояние.</span><br style="font-family: Arial;" /><p style="font-family: Arial;">В правой части формы отображаются все файлы
выбранной слева группы, включая все файлы всех подгрупп и папок. Это
позволяет выполнять операции либо над всеми файлами рабочего
пространства, либо только над частью, находящейся в фокусе пользователя
в данный момент.</p><p style="font-family: Arial;">Над списком ресурсов и над деревом могут
выполняться операции Drag-And-Drop, что позволяет оперативно
перестраивать приоритеты и стратегию обработки. Перемещения с помощью клавиатуры тоже возможно. </p><h3 style="font-family: Arial;">Виртуальные директории</h3>
<p style="font-family: Arial;">Пользователь может использовать как абсолютную, так и
относительную&nbsp; адресацию файлов в дисковом пространстве.
Относительная адресация аналогична принятой в системе Visual Prolog.
Предварительно определяется имя виртуальной директории и это имя&nbsp;
используется в качестве префикса в маршруте файла.</p><p style="font-family: Arial;">Относительная адресация позволяет переносить рабочее пространство с
одного компьютера на другой, переопределив лишь расположение
виртуальных директорий.</p><p style="font-family: Arial;">Пользователь
может определить неограниченное число виртуальных директорий и
редактировать их расположение на данном компьютере. Однако виртуальные
директории, установленные в системе Visual Prolog не могут быть
изменены средствами WSM. На следующем рисунке показан редактор
виртуальных директорий.</p><p style="font-family: Arial;"><img style="width: 695px; height: 528px;" alt="" src="VirtualDirectoriesRu.PNG" /></p><h3 style="font-family: Arial;"><span style="font-weight: bold;"></span>Язык</h3><span style="font-family: Arial;">
Язык пользовательского интерфейса может быть локализован применительно к предпочтениям пользователя.</span><br style="font-family: Arial;" /><span style="font-family: Arial;">Файл настройки языка&nbsp;LanguageWSM.xml  расположен (и всегда должен там располагаться) в директории исполняемого файла. </span><br style="font-family: Arial;" /><p><span style="font-family: Arial;">Базовым
языком интерфейса является английский, но большинство надписей формы,
диалогов и сообщений может быть переназначено путем редактирования
файла LanguageWSM.xml.</span></p><span style="font-family: Arial;">Переключение языка пользовательского интерфейса находится в разделе "Разное" диалога "WorkSpace Settings".</span><span style="font-weight: bold; font-family: Arial;"></span><h2 style="font-family: Arial;">Архитектура</h2><span style="font-family: Arial;">Архитектура
приложения с самого начала разработки была ориентирована на строгое
разделение пользовательского интерфейса от логической части приложения
в расчете на последующее использование технлогии микросервисов.</span><br style="font-family: Arial;" /><span style="font-family: Arial;">Поэтому первая реализация приложения сразу же предстматривала его&nbsp;разделение на FrontEnd и BackEnd. </span><br style="font-family: Arial;" /><p><span style="font-family: Arial;">Структура моно приложения приведена на следущем рисунке</span></p><span style="font-family: Arial;"></span><img style="width: 640px; height: 413px; font-family: Arial;" alt="" src="WSM_mono.JPG" /><br style="font-family: Arial;" /><p style="font-family: Arial;">Здесь
синими стрелками показаны связи внутри BackEnd и FrontEnd
соответственно, а красными - организация связи между BackEnd &nbsp;и
FrontEnd.</p><p style="font-family: Arial;">Внутри этих структур модули получают доступ к другим
модулям через BE(FE)-Connector, который обращается к регистру объектов
(Entity Registry).</p><p style="font-family: Arial;">События, возникающие по инициативе
противоположной стороны обрабатываются модулем BE(FE) Messages, который
вызывает на исполнение соответствующие предикаты модуля BE(FE) Tasks.
Тот, в свою очередь обращается к остальным модулям BackEnd (FrontEnd).
Получив данные для противоположной стороны, модуль BE(FE)Tasks посылает
сообщение через модуль BE(FE) Event. Противоположная строна
подписывается на события источника данных для нее.<br /></p><p style="font-family: Arial;">Инициатором
обмена данными всегда является FrontEnd, который инициирует выполнение
задач в BackEnd.&nbsp;</p><p style="font-family: Arial;">Работа происходит в асинхронном режиме: отправив
запрос, FrontEnd возвращается к своей работе. BackEnd, получив запрос
выполняет задачу и, возможно, инициирует передачу данных во FrontEnd.
Это может быть либо одно сообщение, либо последовательность сообщений,
которые должны быть обработаны во FrontEnd.</p><p style="font-family: Arial;">Такая структура
приложения позволила практически безболезненно перейти к варианту
раздельных приложений (BackEnd и FrontEnd), взаимодействующих по http-
протоколу, добавив и включив в работу Http-Сервер и Http-Клиент.</p><p style="font-family: Arial;">Структура такого приложения приведена на следующем рисунке</p><p style="font-family: Arial;"><img style="width: 640px; height: 731px;" alt="" src="WSM_CS.JPG" /></p><p style="font-family: Arial;"><span style="font-weight: bold;">Client</span> и <span style="font-weight: bold;">Server </span>&nbsp;сами преобразовывают данные и организуют их передачу между BackEnd и FrontEnd.</p><h2 style="font-family: Arial;">Технологии</h2><span style="font-family: Arial;">При разработке WSM были использованы технологии PDC VIP v.8, технологии и приемы собственной разработки:</span><br style="font-family: Arial;" /><ul style="font-family: Arial;"><li>Регистрация объектов в общедоступной памяти;</li><li>Организация хранения данных в формате XML;</li><li>Обмен данными на основе событий (Event Messaging) в формате namedValueList;</li><li>Организация пространства формы на базе split Screen;</li><li>Организация&nbsp; управления на базе ribbon-панели;</li><li>Клиент-серверная архитектура;</li><li>Обмен данными в по http протоколу;</li><li>Обмен данными в формате Json (при работе по http протоколу);</li><li>Использование очередей сообщений в условиях многопоточного доступа (при работе по http протоколу).<span style="font-weight: bold;"></span></li></ul><h2 style="font-family: Arial;"><span style="font-weight: bold;"></span>Проектная структура приложений</h2><span style="font-family: Arial;">Структура моно-приложения приведена ниже</span><br style="font-family: Arial;" /><img style="width: 463px; height: 893px; font-family: Arial;" alt="" src="WSM_Mono.PNG" /><br style="font-family: Arial;" /><span style="font-family: Arial;">А здесь привдены структуры проектов для&nbsp;Http-FrontEnd и Http-BackEnd</span><br style="font-family: Arial;" /><img style="width: 462px; height: 758px; font-family: Arial;" alt="" src="WSM_Http_FrontEnd.PNG" /><span style="font-family: Arial;"> &nbsp;</span><img style="width: 461px; height: 660px; font-family: Arial;" alt="" src="WSM_Http_BackEnd.PNG" /><p style="font-family: Arial;"></p><br style="font-family: Arial;" />


</body></html>